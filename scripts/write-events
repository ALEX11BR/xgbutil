#!/usr/bin/env python2.7

import sys

events = [
    'KeyPressEvent',
    'KeyReleaseEvent',
    'ButtonPressEvent',
    'ButtonReleaseEvent',
    'MotionNotifyEvent',
    'EnterNotifyEvent',
    'LeaveNotifyEvent',
    'FocusInEvent',
    'FocusOutEvent',
    'KeymapNotifyEvent',
    'ExposeEvent',
    'GraphicsExposureEvent',
    'NoExposureEvent',
    'VisibilityNotifyEvent',
    'CreateNotifyEvent',
    'DestroyNotifyEvent',
    'UnmapNotifyEvent',
    'MapNotifyEvent',
    'MapRequestEvent',
    'ReparentNotifyEvent',
    'ConfigureNotifyEvent',
    'ConfigureRequestEvent',
    'GravityNotifyEvent',
    'ResizeRequestEvent',
    'CirculateNotifyEvent',
    'CirculateRequestEvent',
    'PropertyNotifyEvent',
    'SelectionClearEvent',
    'SelectionRequestEvent',
    'SelectionNotifyEvent',
    'ColormapNotifyEvent',
    'ClientMessageEvent',
    'MappingNotifyEvent',
]

assert len(sys.argv) == 2

if sys.argv[1] == 'evtypes':
    print 'package xevent'
    print '''/*
    Defines event types and their associated methods automatically.
    
    Eventually, the no-op implementations of 'Bytes' will move out of here.

    This file is automatically generated using `scripts/write-events evtypes`.

    Edit it at your peril.
*/'''
    print
    print 'import ('
    print '\t"fmt"'
    print
    print '\t"github.com/BurntSushi/xgb/xproto"'
    print ')'
    print

    for e in events:
        # Skip ClientMessageEvent and ConfigureNotifyEvent
        # We define these manually in xevents/types_manual.go
        if e in ('ClientMessageEvent', 'ConfigureNotifyEvent'):
            continue

        print 'type %s struct {' % e
        print '    *xproto.%s' % e
        print '}'
        print
        print 'const %s = xproto.%s' % (e[:-5], e[:-5])
        print
        print 'func (ev *%s) Bytes() []byte { return nil }' % e
        print
        print 'func (ev %s) String() string {' % e
        print '    return fmt.Sprintf("%%v", ev.%s)' % e
        print '}'
        print
elif sys.argv[1] == 'callbacks':
    print 'package xevent'
    print '''/*
    Does all the plumbing to allow a simple callback interface for users.

    This file is automatically generated using `scripts/write-events callbacks`.

    Edit it at your peril.
*/'''
    print
    print 'import ('
    print '\t"github.com/BurntSushi/xgb/xproto"'
    print
    print '\t"github.com/BurntSushi/xgbutil"'
    print ')'
    print

    for e in events:
        e = e[:-5]
        print 'type %sFun func(xu *xgbutil.XUtil, event %sEvent)' % (e, e)
        print
        print 'func (callback %sFun) '\
                'Connect(xu *xgbutil.XUtil,\nwin xproto.Window) {' % e
        print '    attachCallback(xu, %s, win, callback)' % e
        print '}'
        print
        print 'func (callback %sFun) ' \
                'Run(xu *xgbutil.XUtil, event interface{}) {' % e
        print '    callback(xu, event.(%sEvent))' % e
        print '}'
        print

